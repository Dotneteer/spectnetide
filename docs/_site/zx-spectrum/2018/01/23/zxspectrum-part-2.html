<!DOCTYPE html>
<html lang="en-US">

  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,maximum-scale=2">
    <link rel="stylesheet" type="text/css" media="screen" href="/spectnetide/assets/css/style.css?v=">
    <link href="https://fonts.googleapis.com/css?family=Fira+Sans:400,400i,700,700i|Roboto:400,400i,700,700i&amp;subset=latin-ext" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Ubuntu+Mono:400,700&amp;subset=greek,greek-ext" rel="stylesheet">

    <!-- Begin Jekyll SEO tag v2.5.0 -->
<title>ZX Spectrum IDE — Part #2: The ZX Specrum Emulator Challenge | SpectNet IDE</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="ZX Spectrum IDE — Part #2: The ZX Specrum Emulator Challenge" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Today we have powerful computers on our desktops, notebooks and tablets in out satchels, bags or rucksacks, and smartphones in our pockets. In 1983 when my software developer career started—I was 15—, I had only a ZX Spectrum home computer (Figure 1) with an 8-bit Z80A CPU, 48K RAM and a separate cassette tape unit—which was the poor man’s hard disk drive that time." />
<meta property="og:description" content="Today we have powerful computers on our desktops, notebooks and tablets in out satchels, bags or rucksacks, and smartphones in our pockets. In 1983 when my software developer career started—I was 15—, I had only a ZX Spectrum home computer (Figure 1) with an 8-bit Z80A CPU, 48K RAM and a separate cassette tape unit—which was the poor man’s hard disk drive that time." />
<link rel="canonical" href="http://localhost:4000/spectnetide/zx-spectrum/2018/01/23/zxspectrum-part-2.html" />
<meta property="og:url" content="http://localhost:4000/spectnetide/zx-spectrum/2018/01/23/zxspectrum-part-2.html" />
<meta property="og:site_name" content="SpectNet IDE" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-01-23T13:20:00+01:00" />
<script type="application/ld+json">
{"headline":"ZX Spectrum IDE — Part #2: The ZX Specrum Emulator Challenge","dateModified":"2018-01-23T13:20:00+01:00","datePublished":"2018-01-23T13:20:00+01:00","url":"http://localhost:4000/spectnetide/zx-spectrum/2018/01/23/zxspectrum-part-2.html","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/spectnetide/zx-spectrum/2018/01/23/zxspectrum-part-2.html"},"description":"Today we have powerful computers on our desktops, notebooks and tablets in out satchels, bags or rucksacks, and smartphones in our pockets. In 1983 when my software developer career started—I was 15—, I had only a ZX Spectrum home computer (Figure 1) with an 8-bit Z80A CPU, 48K RAM and a separate cassette tape unit—which was the poor man’s hard disk drive that time.","@type":"BlogPosting","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

  </head>

  <body>

    <!-- HEADER -->
    <div class="outer">
        <header class="inner">
          <h1 class="post-title">ZX Spectrum IDE — Part #2: The ZX Specrum Emulator Challenge</h1>
        </header>
    </div>

    <!-- MAIN CONTENT -->

    <div id="main_content_wrap" class="outer">
        <section id="main_content" class="main-columns">
            <section class="main-area">
              <div class="post-attrs">
                <span class="post-label">Published</span>
                <span class="post-value">23 Jan 2018</span>
                <span class="post-label">Category</span>
                <span class="post-value">ZX-Spectrum</span>
              </div>
              <!-- LINKS TO PREVIOUS/NEXT -->
              <div class="links-top">
                <div class="link">
                  
                    <a class="prev" href="/zx-spectrum/2018/01/03/zxspectrum-part-1.html">&laquo; ZX Spectrum IDE — Part #1: How I Started SpectNetIde</a>
                  
                </div>
                <div class="link-right">
                  
                    <a class="next" href="/zx-spectrum/2018/01/23/zxspectrum-part-3.html">ZX Spectrum IDE — Part #3: A Brief Overview of the Z80 CPU &raquo;</a>
                  
                </div>
              </div>
              <div class="content-separator"></div>

              <p>Today we have powerful computers on our desktops, notebooks and tablets in out satchels, bags or rucksacks, and smartphones in our pockets. In 1983 when my software developer career started—I was 15—, I had only a ZX Spectrum home computer (Figure 1) with an 8-bit Z80A CPU, 48K RAM and a separate cassette tape unit—which was the poor man’s hard disk drive that time.</p>

<p><img src="/assets/images/zx-spectrum/f0101.jpg" alt="f0101" /></p>

<p><em><strong>Figure 1</strong>: The ZX Spectrum (source: Wikipedia.org)</em></p>

<p>The father of Spectrum was Sir Clive Sinclair (Figure 2). He’s probably the most famous person in the British home computer industry. God bless him!</p>

<p><img src="/assets/images/zx-spectrum/f0102.jpg" alt="f0102" /></p>

<p><em><strong>Figure 2</strong>: Sir Clive Sinclair with his miniature television set in 1981 (source: dailymail.co.uk)</em></p>

<p>That great computer was an affordable that time with its price around £130. In 1982 my father used the help of a friend who was one of the privileged Hungarians working in West Germany—yes, that time we had two Germanies—and bought me a ZX 81. Almost one year later my father who had seen my enthusiasm for computer programming, collected the necessary amount of Deutsch Mark—the former West German currency—and got me a ZX Spectrum.</p>

<p>In the 80’s we did not have monitors. We used standard TV sets that received analog signals and had to be tuned to a particular TV channel to display the screen. This simple fact leads to a troublesome design aspect of the screen generation, which is one of the hardest challenges when implementing the emulator.</p>

<h3 id="the-architecture-of-zx-spectrum-16k48k">The Architecture of ZX Spectrum 16K/48K</h3>

<p>Looking back to the ZX Spectrum’s architecture, you can see that it resembles the computer architectures we use today. Nonetheless, it’s much simpler. Figure 3 shows the simplified blueprint of the machine’s building blocks.</p>

<p><img src="/assets/images/zx-spectrum/f0103.png" alt="f0103" /></p>

<p><em><strong>Figure 3</strong>: The architecture of Zx Specrum</em></p>

<h3 id="the-cpu">The CPU</h3>

<p>The soul of Spectrum is the <strong>Zilog Z80A CPU</strong>. In the 1980s, it was one of the cheapest but still powerful microprocessors available in the market. Z80A supports a speed of up to 4MHz, and it can address 64K of memory (with a 16-bit address bus). This CPU became popular both in the industry and among hobbyists, for it has simple interfacing requirements.</p>

<p>From the 40 pins of the chip (Figure 4), 16 make the address bus (A0-A15), eight of them work as the data bus, two provide the power supply, and one receives the clock signal. All the other pins control the CPU, the bus, the memory or I/O.</p>

<h3 id="the-memory">The Memory</h3>

<p>The operating system of ZX Spectrum is stored in the ROM (Read-Only Memory), which has a size of 16KBytes. I repeat it: 16 Kbytes. How many Linux/Windows/Mac executables do you know that do not exceed this size? The <strong>ZX Spectrum ROM</strong> contains not only an OS with the ability to manage some peripherals (including a printer!), but also an editor, a <strong>BASIC interpreter</strong>, a floating-point calculator subsystem, and a character generator bitmap.</p>

<p>When the CPU addresses the range between $0000 and $3fff, it reaches the ROM.</p>

<p>Of course, you need RAM (Random Access Memory) to store dynamic data.</p>

<p>ZX Spectrum initially had two models, the 16K, and 48K models, naming the amount of RAM available. The cheaper model provided RAM for the $4000–$7fff address range, while the more expensive one added extra 32K for the $8000–$ffff range. A part of the lower part of the RAM ($4000–$7fff) was reserved as the video display memory ($4000–$5aff).</p>

<h3 id="peripherals">Peripherals</h3>

<p>It’s not easy to believe that the old ZX Spectrum contained only three simple peripherals: a keyboard matrix with 40 keys (5*8), a speaker controlled with a single bit, and a cassette device with an input (EAR) and an output (MIC).</p>

<p><img src="/assets/images/zx-spectrum/f0104.png" alt="f0104" /></p>

<p><em><strong>Figure 4</strong>: The motherboard of ZX Spectrum 48K (source: Wikipedia.org)</em></p>

<h3 id="the-ula-chip">The ULA Chip</h3>

<p>If the CPU was the soul of the machine, another chip, the <strong>ULA (Uncommitted Logic Array)</strong> was the heart. Besides providing a video display generator, it coordinated the CPU access to memory and peripherals. The ULA chip had a difficult task. Because the electron beam in the cathode-ray tube that used to display the TV-screen that time could not be interrupted, the ULA provided very accurate timing and got priority over the CPU when accessing resources.</p>

<h3 id="other-spectrum-models">Other Spectrum Models</h3>

<p>After the release of the first <strong>ZX Spectrum</strong> model in 1982, Sinclair issued two new models. <strong>ZX Spectrum+</strong> (1984) had a new case with an injection-molded keyboard and a reset button. Two years later, <strong>Spectrum 128K</strong> went to the market (developed in conjunction with the Spanish distributor Investrónica). As its name suggests, this model provided 128K of RAM, with seven 16K banks that could be paged into the $c000–$ffff memory address range. It had two 16K ROMs on two pages that could be paged into the $0000–$3fff range. One of the ROMs was an updated version of the original ZX Spectrum ROM; the other contained a new editor and an extended BASIC interpreter.</p>

<p>Spectrum 128K also had a separate PSG (Programmable Sound Generator), the AY-3-8912 chip, that also provided an RS-232 I/O port.</p>

<p>In 1986, Sinclair sold the Spectrum brand to Amstrad (another British electronics company).</p>

<p>Amstrad’s first release was the ZX Spectrum +2 computer, that was mostly identical to Spectrum 128K. It added a built-in cassette recorder and slightly altered the ROMs. In 1987, two model followed +2, namely +2A and +3 that had four ROMs with floppy disk support. The +3 model had a built-in floppy disk drive.</p>

<p>Since 1984, dozens of official and unofficial clones of the original ZX Spectrum were created. Sinclair licensed the Spectrum design to the USA-based Timex corporation, which created a few new and innovative models.</p>

<p>The countries of the Eastern block (Czech Republic, Russia, Romania, Poland, etc.) have created numerous unofficial clones.</p>

<p>In April 2017, a team of five Spectrum fans (<em>Rick Dickinson</em>, <em>Victor Trucco</em>, <em>Fabio Belavenuto</em>, <em>Jim Bagley</em>, <em>Henrique Olifiers</em>) created a Kickstarter campaign to design and manufacture a new reincarnation named ZX Spectrum Next. They successfully collected more than 700,000 pounds from backers. As of this writing, they have delivered the first developer kits (new motherboards) to backers and work on improving the initial Next model.</p>

<h3 id="the-challenge">The Challenge</h3>

<p>When I started the <a href="https://github.com/Dotneteer/spectnetide">SpectNetIde</a> project, I had a roadmap in my mind, with these milestones:</p>

<ul>
  <li>ZX Spectrum 48K emulator, tape emulation</li>
  <li>ZX Spectrum 48K emulator integrated with Visual Studio 2017, code discovery and debugging (SpectNetIde)</li>
  <li>Z80 Assembler in Visual Studio 2017, source code debugging support</li>
  <li>ZX Spectrum 128K emulator in SpectNetIde, tooling support updated</li>
</ul>

<p>Later, as I progressed and got experience, I augmented the roadmap with these items:</p>

<ul>
  <li>ZX Spectrum +3E emulator with additional tooling support</li>
  <li>ZX Spectrum +3E emulator + floppy drive emulation</li>
  <li>Additional ZX Spectrum development tools (such as Z80 code unit testing)</li>
  <li>ZX Spectrum Next emulation</li>
  <li>ZX Spectrum Next development tools</li>
</ul>

<p>I successfully managed to leave the first group of milestones behind me, and now, I’m working on the Spectrum +3E emulator.</p>

<p>During the way I’ve been learning a lot. A few things that had seemed straightforward at the beginning went complex. Other things that had looked difficult were not as hard to implement.</p>

<p>In the next few articles, I show you the main challenges I met when implementing the ZX Spectrum 48K emulator. Here is a list of them:</p>

<ul>
  <li>Emulating and testing the Z80A CPU</li>
  <li>Creating the video display</li>
  <li>Contended memory and I/O</li>
  <li>Generating sound</li>
  <li>Creating a virtual tape device</li>
</ul>

<p>Stay tuned! Next time I will post an article about Z80A CPU emulation.</p>


              <!-- LINKS TO PREVIOUS/NEXT -->
              <div class="links-bottom">
                  <div class="link">
                    
                      <a class="prev" href="/zx-spectrum/2018/01/03/zxspectrum-part-1.html">&laquo; ZX Spectrum IDE — Part #1: How I Started SpectNetIde</a>
                    
                  </div>
                  <div class="link-right">
                    
                      <a class="next" href="/zx-spectrum/2018/01/23/zxspectrum-part-3.html">ZX Spectrum IDE — Part #3: A Brief Overview of the Z80 CPU &raquo;</a>
                    
                  </div>
              </div>
              <div id="disqus_thread"></div>
            </section>
            <aside class="sidebar">
              <div class="sidebar-title"><a href="/">Dotneteer's BLOG</a></div>
              <div class="sidebar-title">More in this category:</div>
              <ul class="sidebar-list">
                   
                  
                   <li class="post-list-item"><a href="/zx-spectrum/2018/02/01/zxspectrum-part-5.html">ZX Spectrum IDE — Part #5: Implementing Z80 instructions (1)</a></li> 
                  
                   
                  
                   <li class="post-list-item"><a href="/zx-spectrum/2018/01/26/zxspectrum-part-4.html">ZX Spectrum IDE — Part #4: Emulating the Z80 CPU</a></li> 
                  
                   
                  
                   <li class="post-list-item"><a href="/zx-spectrum/2018/01/23/zxspectrum-part-3.html">ZX Spectrum IDE — Part #3: A Brief Overview of the Z80 CPU</a></li> 
                  
                   
                  
                   <li class="post-list-item"><a href="/zx-spectrum/2018/01/23/zxspectrum-part-2.html">ZX Spectrum IDE — Part #2: The ZX Specrum Emulator Challenge</a></li> 
                  
                   
                  
                   <li class="post-list-item"><a href="/zx-spectrum/2018/01/03/zxspectrum-part-1.html">ZX Spectrum IDE — Part #1: How I Started SpectNetIde</a></li> 
                  
                  
              </ul>
              <div class="sidebar-title">Other categories:</div>
              <ul class="sidebar-list">
                   
                   <li class="post-list-item"><a href="/category/zx-spectrum.html">ZX-Spectrum</a></li> 
                  
              </ul>
            </aside>
          </section>
        </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p>&copy; Istvan Novak, 2016-2019</p>
      </footer>
    </div>


    

    <!-- DISQUS -->
<script>

  /**
   *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
   *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/

  
  var disqus_config = function () {
  this.page.url = "http://localhost:4000/zx-spectrum/2018/01/23/zxspectrum-part-2.html";  // Replace PAGE_URL with your page's canonical URL variable
  this.page.identifier = "/zx-spectrum/2018/01/23/zxspectrum-part-2.html"; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
  };

  (function() { // DON'T EDIT BELOW THIS LINE
    var d = document, s = d.createElement('script');
    s.src = 'https://dotneteer.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </body>
</html>